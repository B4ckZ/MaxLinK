<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAXLINK Dashboard</title>
    <!-- Polices -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS de base -->
    <link rel="stylesheet" href="css/nord-theme.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/custom-positions.css">
    
    <!-- Le gestionnaire de widgets chargera dynamiquement les CSS des widgets -->
</head>
<body>
    <div class="dashboard">
        <!-- Les widgets seront injectés ici via JavaScript -->
    </div>

    <!-- Scripts core -->
    <script src="js/utils/utils.js"></script>
    <script src="js/core/theme-switcher.js"></script>
    <script src="js/core/widget-manager.js"></script>
    <script src="js/core/dashboard.js"></script>
    
    <!-- Script de vérification de la structure des fichiers -->
    <script>
        // Fonction pour vérifier l'existence d'un fichier
        function checkFileExists(url) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open('HEAD', url, true);
                xhr.onload = function() {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        resolve(true);
                    } else {
                        resolve(false);
                    }
                };
                xhr.onerror = function() {
                    resolve(false);
                };
                xhr.send();
            });
        }

        // Liste des widgets et leurs fichiers nécessaires
        const widgetsToCheck = [
            'logo',
            'mqtt-logs-509-511',
            'server-monitoring',
            'wifi-stats',
            'mqtt-server'
        ];

        // Fonction principale de vérification
        async function verifyFiles() {
            console.log("=== VÉRIFICATION DES FICHIERS ===");
            
            // Vérification des fichiers core
            const coreFiles = [
                'css/nord-theme.css',
                'css/base.css',
                'css/layout.css',
                'css/custom-positions.css',
                'js/core/theme-switcher.js',
                'js/utils/utils.js',
                'js/core/widget-manager.js',
                'js/core/dashboard.js'
            ];
            
            console.log("Vérification des fichiers core:");
            for (const file of coreFiles) {
                const exists = await checkFileExists(file);
                console.log(`- ${file}: ${exists ? '✓' : '✗'}`);
            }
            
            // Vérification des widgets
            console.log("\nVérification des widgets:");
            for (const widget of widgetsToCheck) {
                console.log(`\nWidget: ${widget}`);
                
                const widgetFiles = [
                    `widgets/${widget}/${widget}.html`,
                    `widgets/${widget}/${widget}.css`,
                    `widgets/${widget}/${widget}.js`
                ];
                
                for (const file of widgetFiles) {
                    const exists = await checkFileExists(file);
                    console.log(`- ${file}: ${exists ? '✓' : '✗'}`);
                }
            }
            
            console.log("\n=== FIN DE LA VÉRIFICATION ===");
        }

        // Exécuter la vérification au chargement
        document.addEventListener('DOMContentLoaded', verifyFiles);
    </script>
    
    <!-- Configuration simplifiée des widgets -->
    <script>
        // Configuration des widgets à charger (simplifiée)
        const widgetsConfig = [
            { id: 'logo' },
			{ id: 'theme-toggle' },
			{ id: 'reboot-button' },
            { id: 'server-monitoring' },
            { id: 'mqtt-logs-509-511' },
			{ id: 'mqtt-logs-999' },
            { id: 'wifi-stats' },
			{ id: 'uptime' },
            { id: 'mqtt-server' }
        ];

        // Initialisation du dashboard avec la configuration
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser le gestionnaire de widgets
            WidgetManager.init(widgetsConfig);
            
            // Ajouter des commandes accessibles via la console
            window.DashboardCommands = {
                // Rafraîchir les widgets
                refreshWidgets: function() {
                    Object.keys(WidgetManager.getWidgets()).forEach(id => {
                        const widget = WidgetManager.getWidget(id);
                        if (widget && typeof widget.loadData === 'function') {
                            widget.loadData();
                        }
                    });
                    return true;
                }
            };
        });
    </script>
</body>
</html>